# .github/workflows/rss_fetcher.yml

name: RSS News Fetcher (å®šæ—¶æŠ“å–æ–°é—»)

# --- 1. è§¦å‘å™¨é…ç½® (Schedule) ---
# å®šä¹‰å·¥ä½œæµçš„è¿è¡Œæ—¶é—´ã€‚
# cron è¡¨è¾¾å¼çš„æ ¼å¼: minute hour day_of_month month day_of_week
# '0 0 * * *' è¡¨ç¤ºæ¯å¤© UTC æ—¶é—´ 00:00 è¿è¡Œã€‚
# åŒ—äº¬æ—¶é—´ (BJT) æ˜¯ UTC+8ã€‚æ‰€ä»¥ BJT 8:00 AM å¯¹åº” UTC 00:00 AMã€‚
on:
  schedule:
    # æ¯å¤© UTC 00:00 è¿è¡Œï¼Œå³åŒ—äº¬æ—¶é—´ (UTC+8) æ¯å¤©æ—©ä¸Š 8 ç‚¹
    - cron: '0 0 * * *' 
  # ä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘ï¼Œæ–¹ä¾¿è°ƒè¯•
  workflow_dispatch:

# --- 2. è¿è¡Œçš„å·¥ä½œ (Jobs) ---
jobs:
  build:
    runs-on: ubuntu-latest # ä½¿ç”¨æœ€æ–°çš„ Ubuntu è™šæ‹Ÿæœºè¿è¡Œ

    # è®¾ç½®ç¯å¢ƒå˜é‡ (å¯é€‰ï¼Œä½†æ¨è)
    env:
      # ä¸ºäº†ç¡®ä¿å®‰è£…çš„ä¾èµ–èƒ½å¤Ÿè¢«æ‰¾åˆ°
      PYTHONIOENCODING: utf-8 
      
    # --- 3. è¿è¡Œæ­¥éª¤ (Steps) ---
    steps:
    
    # æ­¥éª¤ A: æ£€å‡ºä»£ç 
    - name: Checkout repository
      uses: actions/checkout@v4

    # æ­¥éª¤ B: è®¾ç½® Python ç¯å¢ƒ
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        # ä½¿ç”¨ Python 3.10
        python-version: '3.10' 
        
    # æ­¥éª¤ C: å®‰è£…ä¾èµ–
    - name: Install dependencies
      run: |
        # è¿™ä¸€æ­¥éœ€è¦ä½ çš„ Python è„šæœ¬åå’Œä¾èµ–åº“
        # ä½ çš„è„šæœ¬ä¸­ä½¿ç”¨äº†ï¼šfeedparser
        pip install feedparser
        # å¦‚æœä½ æœ‰å¾ˆå¤šä¾èµ–ï¼Œæ¨èä½¿ç”¨ requirements.txt æ–‡ä»¶æ¥å®‰è£…ï¼špip install -r requirements.txt

    # æ­¥éª¤ D: æ‰§è¡Œ Python è„šæœ¬
    - name: Run the Python script
      # æ›¿æ¢ä¸ºä½ çš„ Python è„šæœ¬çš„å®é™…æ–‡ä»¶å
      run: python rss_scraper.py 

    # æ­¥éª¤ E: æäº¤æ›´æ–°åçš„æ–‡ä»¶ (æœ€é‡è¦çš„ä¸€æ­¥)
    # è„šæœ¬è¿è¡Œåä¼šç”Ÿæˆ news_data_YYYYMMDD.txtï¼Œéœ€è¦å°†å…¶æäº¤å›ä»“åº“
    - name: Commit and Push changes
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        # æäº¤çš„æ¶ˆæ¯
        commit_message: "ğŸ¤– Feat: Auto-fetch RSS news data (Scheduled Run)"
        # è‡ªåŠ¨å°†æ‰€æœ‰æ›´æ”¹çš„æ–‡ä»¶æäº¤å¹¶æ¨é€åˆ°å½“å‰åˆ†æ”¯
        branch: main # ç¡®ä¿ä½ çš„ä¸»åˆ†æ”¯åç§°æ­£ç¡®ï¼Œå¯èƒ½æ˜¯ main æˆ– master
